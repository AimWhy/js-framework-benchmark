const Config={t:"DooHTML",o:"bind",l:{p:-1,i:0,T:1},m:{BEG:"{{",END:"}}"},u:"data-key",N:"key"},version="v0.96.2",getItemValue=(e,t)=>e[t]?e[t]:"",isTable=e=>["TABLE","TBODY","THEAD","TFOOT","TR","TH"].includes(e.tagName),render=(e,t,o=0)=>{t?.C?renderTable(e,t,o):renderHTML(e,t,o)},renderHTML=(e,t,o=0,a=null)=>{let l,n,d=e.length,r=t.D[0],s=a?o+d:d-o;s>d&&(s=d);let c=r.A.length;const p=(t,o)=>{for(let a=0;a<c;a++)n=getNode(t,r.A[a][1],0),n?"textContent"===r.A[a][2]?n.textContent=e[o][r.A[a][0]]:n.setAttribute(r.A[a][2],e[o][r.A[a][0]]):console.info("Field:"+r.A[a][0]+" does not exist")},i=r.L;for(let t=o;t<s;t++)l=r.h,p(l,t),r.appendChild(l.cloneNode(!0))[Config.N]=getItemValue(e[t],i)},getNode=(e,t,o)=>{let a=t[o];return e.childNodes[a]?getNode(e.childNodes[a],t,++o):e},renderTable=(e,t,o=0)=>{0!==e.length?renderHTML(e,t,o):t.textContent=""},append=(e,t,o=0)=>{renderHTML(e,t,o,e.length-o)},dooParse=e=>{let t=e.cloneNode(!0);t.removeAttribute(Config.o),t.removeAttribute("data-key");let o=t.outerHTML.replace(/\t/g,"").replace(/\n/g,""),a=o;["src","selected","checked","disabled","readonly"].forEach((e=>{o=o.replace(new RegExp(" "+e+'="{{(.+)}}"',"g")," doo-"+e+'="{{$1}}"')}));let l=a===o,n=document.createElement("template");n.innerHTML=o;let d=[];const r=(e,t,o)=>{let a=[],l=e;for(;l!==n.firstElementChild;){let e=l.previousSibling,t=0;for(;e;)t++,e=e.previousSibling;l=l.parentNode,l&&a.unshift(t)}d.push([t,a.slice(1),o])},s=document.createTreeWalker(n.content,NodeFilter.SHOW_TEXT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let c=s.nextNode(),p=[];for(;c;){let e=c.wholeText.trim();if(0===e.indexOf("{{")&&e.lastIndexOf("}}")===e.length-2);else{let t=e.replace(/{{/g,"<span>{{").replace(/}}/g,"}}</span>");p.push({node:c.parentNode,v:e,H:t})}c=s.nextNode()}for(let e=0,t=p.length;e<t;e++)p[e].node.innerHTML=p[e].node.innerHTML.replace(p[e].v,p[e].H);let i=n.content.cloneNode(!0);const T=document.createTreeWalker(i,NodeFilter.SHOW_TEXT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});let m=T.nextNode();for(;m;)0===m.textContent.trim().indexOf("{{")&&r(m,m.textContent.replace("{{","").replace("}}",""),"textContent"),m=T.nextNode();const g=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:()=>NodeFilter.FILTER_ACCEPT});for(m=g.nextNode();m;){for(const e of[...m.attributes])e.nodeValue.includes("{{")&&r(m,e.nodeValue.replace("{{","").replace("}}",""),e.name);m=g.nextNode()}let u=i.firstElementChild.outerHTML;return d.forEach((e=>{let t="{{"+e[0]+"}}";u=u.replace(new RegExp(t,"g"),"")})),i.outerHTML=u,{h:i.firstElementChild,R:l,A:d}},fetchTemplate=e=>new Promise(((t,o)=>{const a=new XMLHttpRequest;a.open("GET",e),a.onload=()=>t(a.responseText),a.onerror=()=>o(a.statusText),a.send()})),createDooTemplate=async e=>{let t="";t=0===e.indexOf("#")?document.querySelector(e).outerHTML:await fetchTemplate(e);let o=document.createElement("div");o.innerHTML=t,o.querySelector("template")&&(o.innerHTML=o.querySelector("template")?t:`<template><center><pre>The template you are trying to import does not have a &lt;template&gt tag</pre><div style="color:red">${template}</div></enter></template>`);let a=o.querySelector("template").cloneNode(!0);a.removeAttribute("id");let l=document.createElement("template");return l.innerHTML=a.innerHTML,l},initReactiveDataNodes=e=>{const t=[],o=e=>{let t=0;for(;e.parentElement;)e=e.parentElement,t++;return t};e.innerHTML=e.innerHTML.replace(/\$\{(.+?)\}/gm,((t,o)=>isNaN(o)?e.getAttribute(o)||"":Config.m.BEG+e.I?.[o-1]+Config.m.END||""));const a=e.content.querySelectorAll(`[${Config.o}]`);a.forEach((t=>{t.hasAttribute("data-src")||t.setAttribute("data-src",e.hasAttribute("doo-dispatch")?"DooX":Config.o),t.removeAttribute("data-src")})),(e=>{[...e].map((e=>({F:e,level:o(e),M:e.getAttribute("data-src")?.startsWith("this.parent"),O:e.hasAttribute("data-norepeat")}))).sort(((e,t)=>t.level-e.level)).forEach((({F:e,level:o,M:a,O:l},n)=>{const d="|STYLE|LINK|".includes(`|${e.tagName}|`)?e:e.parentElement&&"|DL|UL|TBODY|THEAD|TFOOT|TR|SELECT|SECTION|".includes(`|${e.parentElement.tagName}|`)?e.parentElement:document.createElement("data"),r=dooParse(e);Object.assign(d,{L:e.getAttribute(Config.o),h:r.h,R:r.R,A:r.A,name:n,level:o,M:a,O:l,C:isTable(d)}),"DATA"!==d.tagName&&"STYLE"!==d.tagName&&"LINK"!==d.tagName||e.parentElement?.replaceChild(d,e)||console.warn("Templates should only have one child node"),t.push(d)}))})(a),e.D=t},setNodeValues=(e,t)=>{for(let o=0;o<len;o++){const a=getNode(e,place.A[o][1],0);a?"textContent"===place.A[o][2]?a.textContent=data[t][place.A[o][0]]:a.setAttribute(place.A[o][2],data[t][place.A[o][0]]):console.info("Field:"+place.A[o][0]+" does not exist")}if(this.S){let e=place.querySelectorAll(place.h.tagName);for(let t=start;t<stop;t++){let o=e.item(t);const a=o||place.h;setNodeValues(a,t),o||(place.appendChild(a.cloneNode(!0))[Config.N]=getItemValue(data[t],this.L))}}else for(let e=start;e<stop;e++){const t=place.h;setNodeValues(t,e),place.appendChild(t.cloneNode(!0))[Config.N]=getItemValue(data[e],this.L)}},useTemplate=async(e,t=[])=>{const o=e.startsWith("#")?e:`#${e}`,a=`doo-${e}`,l=await createDooTemplate(o);initReactiveDataNodes(l);return document.querySelector(a).parentElement.replaceChild(l.content,document.querySelector(a)),render(t,l.D[0],0),l};export{useTemplate,append,render,Config,version};